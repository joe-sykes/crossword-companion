<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Crossword Companion is an all-in-one tool to help you solve crosswords efficiently. Search definitions, find anagrams, explore indicator words, and track recent searches without giving away answers.">

<title>Crossword Companion</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Lexend+Deca:wght@100..900&family=Roboto+Slab:wght@100..900&display=swap" rel="stylesheet">
<link rel="stylesheet" href="styles.css">

<script src="https://cdn.tailwindcss.com"></script>


</head>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-NT69LLZR5T"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-NT69LLZR5T');
</script>

<body class="bg-gray-100 min-h-screen flex flex-col">

<header class="bg-white dark:bg-gray-700 shadow-md p-4">
  <div class="flex items-center">
    <button id="info-btn" class="ml-4 text-gray-700 hover:text-gray-900 text-xl font-bold">‚ùì</button>
    <button onClick="window.location.reload();" class="flex-1 text-2xl font-bold text-gray-800 dark:text-gray-100 text-center">Crossword Companion</h1>
    <button id="dark-toggle" class="px-2 py-1 border rounded">üåì</button>
  </div>
</header>

<!-- Modal Overlay -->
<div id="info-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
  <!-- Modal Content -->
  <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 max-w-lg w-full relative">
    <!-- Bigger Close Button -->
    <button id="close-modal" class="absolute top-2 right-2 text-3xl text-gray-500 hover:text-gray-700 font-bold">&times;</button>
    <h2 class="text-xl font-bold mb-4 text-gray-800 dark:text-gray-100">About Crossword Companion</h2>
    <p class="text-gray-700 dark:text-gray-200">
      Crossword Companion is an all-in-one tool designed to help you solve crosswords without giving you the answers directly.
      You can search word definitions, find anagrams, explore indicator words, and track your recent searches to boost your solving efficiency.
    </p>
  </div>
</div>



<main class="flex-1 p-4 max-w-6xl mx-auto w-full grid grid-cols-1 md:grid-cols-2 gap-4">

  <!-- Dictionary Card -->
  <div class="tool-card bg-white rounded-lg shadow p-6">
    <h2 class="text-xl font-bold mb-2">Dictionary</h2>
    <input id="dict-input" class="border rounded px-3 py-2 w-full mb-4" placeholder="Search word">
    <button class="bg-yellow-500 text-white px-4 py-2 rounded hover:bg-yellow-600 mb-4 block mx-auto" onclick="searchDictionary()">Search</button>
    <ul id="dict-results" class="mt-2 list-disc pl-5 max-h-64 overflow-y-auto"></ul>
    <div id="dict-info" class="mt-4"></div>
  </div>

  <!-- Anagram Solver -->
  <div class="tool-card bg-white rounded-lg shadow p-6">
    <h2 class="text-xl font-bold mb-2">Anagram Solver</h2>
    <input id="anagram-input" class="border rounded px-3 py-2 w-full mb-4" placeholder="Enter letters (use ? for wildcard)">
    <button class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 mb-4 block mx-auto" onclick="solveAnagram()">Solve</button>
    <ul id="anagram-results" class="mt-2 list-disc pl-5 max-h-64 overflow-y-auto"></ul>
  </div>

  <!-- Indicator Word Finder -->
  <div class="tool-card bg-white rounded-lg shadow p-6">
    <h2 class="text-xl font-bold mb-2">Indicator Word Finder</h2>
    <input id="indicator-input" class="border rounded px-3 py-2 w-full mb-4" placeholder="Enter a word (e.g., expert)">
    <button class="bg-purple-500 text-white px-4 py-2 rounded hover:bg-purple-600 mb-4 block mx-auto" onclick="solveIndicator()">Search</button>
    <ul id="indicator-results" class="mt-2 list-disc pl-5 max-h-64 overflow-y-auto"></ul>
  </div>

  <!-- Recent Searches -->
  <div class="tool-card bg-white rounded-lg shadow p-6">
    <h2 class="text-xl font-bold mb-2">Recent Searches</h2>
    <ul id="recent-results" class="mt-2 list-disc pl-5 max-h-64 overflow-y-auto"></ul>
  </div>

</main>

<footer class="bg-white shadow-inner p-4 text-center text-gray-600">
  ¬© 2025 Crossword Companion&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;Made for Mills ‚ù§Ô∏è
</footer>

<script>
// === Dark Mode ===
const toggle = document.getElementById('dark-toggle');
const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;

// Load saved preference first
const saved = localStorage.getItem('darkMode');
if (saved === "true" || (!saved && prefersDark)) document.documentElement.classList.add('dark');

toggle.addEventListener('click', () => {
  document.documentElement.classList.toggle('dark');
  localStorage.setItem('darkMode', document.documentElement.classList.contains('dark'));
});

// === Helper: clickable words ===
function makeWordsClickable(listId) {
  const ul = document.getElementById(listId);
  if (!ul) return;
  ul.querySelectorAll("li").forEach(li => {
    const text = li.textContent.trim();
    li.innerHTML = `<span class="word-link">${text.charAt(0).toUpperCase() + text.slice(1).toLowerCase()}</span>`;
    li.querySelector(".word-link").addEventListener("click", () => {
      addRecentSearch(text);
      reSearchAll(text);
    });
  });
}

// === Anagram Solver ===
async function solveAnagram(word) {
  const input = word || document.getElementById("anagram-input").value.trim();
  const resultsEl = document.getElementById("anagram-results");
  if (!input) return;
  resultsEl.innerHTML = "<li>Searching...</li>";

  try {
    let res, data, list = [];

    if (input.includes("?")) {
      res = await fetch(`https://crossword-companion.onrender.com/anagram_pattern?pattern=${encodeURIComponent(input)}`);
      data = await res.json();
      list = data.matches || [];
    } else {
      res = await fetch(`https://crossword-companion.onrender.com/anagram?letters=${encodeURIComponent(input)}`);
      data = await res.json();
      list = data.anagrams || [];
    }

    resultsEl.innerHTML = list.length ? list.map(w => `<li>${w}</li>`).join("") : "<li>No results</li>";
    makeWordsClickable("anagram-results");
    addRecentSearch(input);
  } catch (err) {
    console.error(err);
    resultsEl.innerHTML = "<li>Error fetching anagrams</li>";
  }
}

// === Dictionary ===
async function searchDictionary(word) {
  const input = word || document.getElementById("dict-input").value.trim();
  const resultsEl = document.getElementById("dict-results");
  const infoEl = document.getElementById("dict-info");
  if (!input) return;

  resultsEl.innerHTML = "<li>Searching...</li>";
  infoEl.innerHTML = "";

  try {
    const res = await fetch(`https://crossword-companion.onrender.com/dictionary?word=${encodeURIComponent(input)}`);
    const data = await res.json();

    if (data.error) {
      resultsEl.innerHTML = `<li>${data.error}</li>`;
      return;
    }

    // Handle suggestions
    if (Array.isArray(data) && data.length && typeof data[0] === "string") {
      resultsEl.innerHTML = data.map(s => `<li>${s}</li>`).join("");
      infoEl.innerHTML = "<em>Did you mean:</em>";
      return;
    }

    // Add to recent searches
    addRecentSearch(input);

    // Iterate over all homonyms
      let html = '';
    data.forEach(hom => {
      const wordText = hom.hwi.hw || input;
      const pronunciation = hom.hwi.prs?.[0]?.mw || "";
      const fl = hom.fl || "";

      let sensesHtml = '';
      hom.def?.forEach(d => {
        d.sseq.forEach(seqGroup => {
          seqGroup.forEach(senseArr => {
            const sense = senseArr[1];
            if (!sense || !sense.dt) return;
            sense.dt.forEach(dtItem => {
              if (dtItem[0] === 'text') {
                sensesHtml += `<li>${mwTextToHTML(dtItem[1])}</li>`;
              } else if (dtItem[0] === 'vis') {
                dtItem[1].forEach(vis => {
                  sensesHtml += `<li class="dict-example">Example: ${mwTextToHTML(vis.t)}</li>`;
                });
              }
            });
          });
        });
      });

      html += `
        <div class="dict-entry">
          <h3>${wordText} ${pronunciation ? `<span style="font-size:0.9rem;">(${pronunciation})</span>` : ""}</h3>
          <strong>${fl}</strong>
          <ul style="margin-left:1rem; margin-top:0.5rem;">${sensesHtml}</ul>
        </div>
        <hr style="border-color:#e5e7eb; margin:1rem 0;">
      `;
    });

    infoEl.innerHTML = html;
    resultsEl.innerHTML = "";

  } catch (err) {
    console.error(err);
    resultsEl.innerHTML = "<li>Word not found</li>";
  }
}
// === Clean and format Merriam-Webster dictionary markup ===
function mwTextToHTML(text) {
  if (!text) return "";

  // Replace {bc} (M-W definition colon marker) with a bullet separator
  text = text.replace(/{bc}/g, " ‚Ä¢ ");

  // Italics, words in italics
  text = text.replace(/{it}([^}]*){\/it}/g, "<em>$1</em>");
  text = text.replace(/{wi}([^}]*){\/wi}/g, "<em>$1</em>");

  // Small caps
  text = text.replace(/{sc}([^}]*){\/sc}/g, "<strong>$1</strong>");

  // Dictionary links {d_link|word|display}
  text = text.replace(/{d_link\|([^|]*)\|([^}]*)}/g, (m, word, display) =>
    `<a href="#" class="dict-link" data-word="${word}">${display}</a>`
  );

  // Anchor links {a_link|word}
  text = text.replace(/{a_link\|([^}]*)}/g, (m, word) =>
    `<a href="#" class="dict-link" data-word="${word}">${word}</a>`
  );

  // Synonyms / see also {sx|word|...}
  text = text.replace(/{sx\|([^|]*)\|[^}]*}/g, (m, word) =>
    `<a href="#" class="dict-link" data-word="${word}">${word}</a>`
  );

  // Clean up other internal tags
  text = text
    .replace(/{dx}|{\/dx}|{dx_def}[^}]*{\/dx_def}/g, "")
    .replace(/{\/?a_link[^}]*}/g, "")
    .replace(/{\/?d_link[^}]*}/g, "")
    .replace(/{\/?sx[^}]*}/g, "");

  // Remove double spaces or leftover spaces before punctuation
  text = text.replace(/\s+/g, " ").trim();

  return text;
}


// === Event delegation for in-definition links ===
document.addEventListener("click", function (e) {
  if (e.target.classList.contains("dict-link")) {
    e.preventDefault();
    const word = e.target.getAttribute("data-word");
    if (word) {
      searchDictionary(word); // Perform another lookup
    }
  }
});



// === Indicator Finder ===
async function solveIndicator(word) {
  const input = word || document.getElementById("indicator-input").value.trim();
  const resultsEl = document.getElementById("indicator-results");
  if (!input) return;
  resultsEl.innerHTML = "<li>Searching...</li>";

  try {
    const res = await fetch(`https://crossword-companion.onrender.com/indicator?word=${encodeURIComponent(input)}`);
    const data = await res.json();
    const list = data.results || [];

    resultsEl.innerHTML = list.length ? list.map(w => `<li>${w}</li>`).join("") : "<li>No results</li>";
    makeWordsClickable("indicator-results");
    addRecentSearch(input);
  } catch (err) {
    console.error(err);
    resultsEl.innerHTML = "<li>Error fetching indicator data</li>";
  }
}

// === Recent Searches ===
function addRecentSearch(word) {
  if (!word) return;

  let recent = JSON.parse(localStorage.getItem("recentSearches") || "[]");

  // Avoid duplicates
  if (!recent.includes(word.toLowerCase())) {
    recent.unshift(word.toLowerCase()); // add to beginning
    if (recent.length > 10) recent.pop(); // keep last 10
    localStorage.setItem("recentSearches", JSON.stringify(recent));
  }

  renderRecentSearches();
}

function renderRecentSearches() {
  const recentList = document.getElementById("recent-results");
  if (!recentList) return;

  recentList.innerHTML = "";

  const recent = JSON.parse(localStorage.getItem("recentSearches") || "[]");

  recent.forEach(word => {
    const li = document.createElement("li");
    li.innerHTML = `<span class="word-link">${word.charAt(0).toUpperCase() + word.slice(1)}</span>`;
    li.querySelector(".word-link").addEventListener("click", () => {
      reSearchAll(word);
    });
    recentList.appendChild(li);
  });
}

// Run when page loads
window.addEventListener("DOMContentLoaded", () => {
  renderRecentSearches();
});


// === Info window ===
const infoBtn = document.getElementById("info-btn");
const modal = document.getElementById("info-modal");
const closeModal = document.getElementById("close-modal");

// Open modal
infoBtn.addEventListener("click", () => {
  modal.classList.remove("hidden");
});

// Close modal
closeModal.addEventListener("click", () => {
  modal.classList.add("hidden");
});

// Close modal when clicking outside the content
modal.addEventListener("click", (e) => {
  if (e.target === modal) {
    modal.classList.add("hidden");
  }
});



// === Re-run all searches when clicking a recent term ===
function reSearchAll(word) {
  document.getElementById("dict-input").value = word;
  document.getElementById("anagram-input").value = word;
  document.getElementById("indicator-input").value = word;

  searchDictionary(word);
  solveAnagram(word);
  solveIndicator(word);
}

document.addEventListener("DOMContentLoaded", () => {
  const toggle = document.getElementById('dark-toggle');
  const saved = localStorage.getItem('darkMode');

  if (saved === "true") document.body.classList.add('dark-mode');
  if (saved === "false") document.body.classList.remove('dark-mode');

  toggle.addEventListener('click', () => {
    document.body.classList.toggle('dark-mode');
    localStorage.setItem('darkMode', document.body.classList.contains('dark-mode'));
  });
});


document.addEventListener("DOMContentLoaded", () => {
  // Map input IDs -> handler function name or button id to click
  const bindings = {
    "dict-input": { fn: "searchDictionary", buttonId: null },
    "anagram-input": { fn: "solveAnagram", buttonId: null },
    "pattern-input": { fn: "solvePattern", buttonId: null },
    "indicator-input": { fn: "solveIndicator", buttonId: null },
    // add more if you have them: "abbrev-input": { fn: "solveAbbrev", buttonId: "abbrev-btn" }
  };

  Object.entries(bindings).forEach(([inputId, { fn, buttonId }]) => {
    const input = document.getElementById(inputId);
    if (!input) return;

    input.addEventListener("keydown", async (e) => {
      if (e.key !== "Enter") return;
      // ignore Enter in multiline textareas
      if (e.target && e.target.tagName === "TEXTAREA") return;

      e.preventDefault(); // stop form submit / reload

      // 1) If a direct JS function exists, call it
      try {
        const func = window[fn];
        if (typeof func === "function") {
          // If your handler expects the word as arg, pass it; otherwise call with no args
          // Try passing input value safely
          try {
            await func(input.value || undefined);
          } catch (innerErr) {
            // fallback to calling without arguments
            await func();
          }
          return;
        }
      } catch (err) {
        // ignore and try fallback
      }

      // 2) If a button id is given, click it
      if (buttonId) {
        const btn = document.getElementById(buttonId);
        if (btn) {
          btn.click();
          return;
        }
      }

      // 3) Try to find a nearby button with onclick that references the function name and click it
      const formButtons = document.querySelectorAll("button, input[type='button'], input[type='submit']");
      for (const b of formButtons) {
        const on = (b.getAttribute && b.getAttribute("onclick")) || "";
        if (on && on.includes(fn)) {
          b.click();
          return;
        }
      }

      // 4) As a last resort, attempt to call fn from window even if it's not a function (silently fail)
      if (typeof window[fn] === "function") {
        window[fn]();
      } else {
        console.warn(`Enter handler: couldn't find function ${fn} or button for input ${inputId}`);
      }
    });
  });
});



</script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Crossword Companion is an all-in-one tool to help you solve crosswords efficiently. Search definitions, find anagrams, explore indicator words, and track recent searches without giving away answers.">

<title>Crossword Companion</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Lexend+Deca:wght@100..900&family=Roboto+Slab:wght@100..900&display=swap" rel="stylesheet">
<link rel="stylesheet" href="styles.css">

<script src="https://cdn.tailwindcss.com"></script>


</head>
<body class="bg-gray-100 min-h-screen flex flex-col">

<header class="bg-white dark:bg-gray-700 shadow-md p-4">
  <div class="flex items-center">
    <button id="info-btn" class="ml-4 text-gray-700 hover:text-gray-900 text-xl font-bold">‚ùì</button>
    <button onClick="window.location.reload();" class="flex-1 text-2xl font-bold text-gray-800 dark:text-gray-100 text-center">Crossword Companion</h1>
    <button id="dark-toggle" class="px-2 py-1 border rounded">üåì</button>
  </div>
</header>

<!-- Modal Overlay -->
<div id="info-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
  <!-- Modal Content -->
  <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 max-w-lg w-full relative">
    <!-- Bigger Close Button -->
    <button id="close-modal" class="absolute top-2 right-2 text-3xl text-gray-500 hover:text-gray-700 font-bold">&times;</button>
    <h2 class="text-xl font-bold mb-4 text-gray-800 dark:text-gray-100">About Crossword Companion</h2>
    <p class="text-gray-700 dark:text-gray-200">
      Crossword Companion is an all-in-one tool designed to help you solve crosswords without giving you the answers directly.
      You can search word definitions, find anagrams, explore indicator words, and track your recent searches to boost your solving efficiency.
    </p>
  </div>
</div>



<main class="flex-1 p-4 max-w-6xl mx-auto w-full grid grid-cols-1 md:grid-cols-2 gap-4">

  <!-- Dictionary Card -->
  <div class="tool-card bg-white rounded-lg shadow p-6">
    <h2 class="text-xl font-bold mb-2">Dictionary</h2>
    <input id="dict-input" class="border rounded px-3 py-2 w-full mb-4" placeholder="Search word">
    <button class="bg-yellow-500 text-white px-4 py-2 rounded hover:bg-yellow-600 mb-4 block mx-auto" onclick="searchDictionary()">Search</button>
    <ul id="dict-results" class="mt-2 list-disc pl-5 max-h-64 overflow-y-auto"></ul>
    <div id="dict-info" class="mt-4 text-gray-800"></div>
  </div>

  <!-- Anagram Solver -->
  <div class="tool-card bg-white rounded-lg shadow p-6">
    <h2 class="text-xl font-bold mb-2">Anagram Solver</h2>
    <input id="anagram-input" class="border rounded px-3 py-2 w-full mb-4" placeholder="Enter letters (use ? for wildcard)">
    <button class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 mb-4 block mx-auto" onclick="solveAnagram()">Solve</button>
    <ul id="anagram-results" class="mt-2 list-disc pl-5 max-h-64 overflow-y-auto"></ul>
  </div>

  <!-- Indicator Word Finder -->
  <div class="tool-card bg-white rounded-lg shadow p-6">
    <h2 class="text-xl font-bold mb-2">Indicator Word Finder</h2>
    <input id="indicator-input" class="border rounded px-3 py-2 w-full mb-4" placeholder="Enter a word (e.g., expert)">
    <button class="bg-purple-500 text-white px-4 py-2 rounded hover:bg-purple-600 mb-4 block mx-auto" onclick="solveIndicator()">Search</button>
    <ul id="indicator-results" class="mt-2 list-disc pl-5 max-h-64 overflow-y-auto"></ul>
  </div>

  <!-- Recent Searches -->
  <div class="tool-card bg-white rounded-lg shadow p-6">
    <h2 class="text-xl font-bold mb-2">Recent Searches</h2>
    <ul id="recent-results" class="mt-2 list-disc pl-5 max-h-64 overflow-y-auto"></ul>
  </div>

</main>

<footer class="bg-white shadow-inner p-4 text-center text-gray-600">
  ¬© 2025 Crossword Companion&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;Made for Mills ‚ù§Ô∏è
</footer>

<script>
// === Dark Mode ===
const toggle = document.getElementById('dark-toggle');
const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;

// Load saved preference first
const saved = localStorage.getItem('darkMode');
if (saved === "true" || (!saved && prefersDark)) document.documentElement.classList.add('dark');

toggle.addEventListener('click', () => {
  document.documentElement.classList.toggle('dark');
  localStorage.setItem('darkMode', document.documentElement.classList.contains('dark'));
});

// === Helper: clickable words ===
function makeWordsClickable(listId) {
  const ul = document.getElementById(listId);
  if (!ul) return;
  ul.querySelectorAll("li").forEach(li => {
    const text = li.textContent.trim();
    li.innerHTML = `<span class="word-link">${text.charAt(0).toUpperCase() + text.slice(1).toLowerCase()}</span>`;
    li.querySelector(".word-link").addEventListener("click", () => {
      addRecentSearch(text);
      reSearchAll(text);
    });
  });
}

// === Anagram Solver ===
async function solveAnagram(word) {
  const input = word || document.getElementById("anagram-input").value.trim();
  const resultsEl = document.getElementById("anagram-results");
  if (!input) return;
  resultsEl.innerHTML = "<li>Searching...</li>";

  try {
    let res, data, list = [];

    if (input.includes("?")) {
      res = await fetch(`http://127.0.0.1:8000/anagram_pattern?pattern=${encodeURIComponent(input)}`);
      data = await res.json();
      list = data.matches || [];
    } else {
      res = await fetch(`http://127.0.0.1:8000/anagram?letters=${encodeURIComponent(input)}`);
      data = await res.json();
      list = data.anagrams || [];
    }

    resultsEl.innerHTML = list.length ? list.map(w => `<li>${w}</li>`).join("") : "<li>No results</li>";
    makeWordsClickable("anagram-results");
    addRecentSearch(input);
  } catch (err) {
    console.error(err);
    resultsEl.innerHTML = "<li>Error fetching anagrams</li>";
  }
}

// === Dictionary ===
async function searchDictionary(word) {
  const input = word || document.getElementById("dict-input").value.trim();
  const resultsEl = document.getElementById("dict-results");
  const infoEl = document.getElementById("dict-info");
  if (!input) return;

  resultsEl.innerHTML = "<li>Searching...</li>";
  infoEl.innerHTML = "";

  try {
    const res = await fetch(`http://127.0.0.1:8000/dictionary?word=${encodeURIComponent(input)}`);
    const data = await res.json();

    if (data.error) {
      resultsEl.innerHTML = `<li>${data.error}</li>`;
      return;
    }

    // Handle suggestions
    if (Array.isArray(data) && data.length && typeof data[0] === "string") {
      resultsEl.innerHTML = data.map(s => `<li>${s}</li>`).join("");
      infoEl.innerHTML = "<em>Did you mean:</em>";
      return;
    }

    // Add to recent searches
    addRecentSearch(input);

    // Iterate over all homonyms
    let html = '';
    data.forEach(hom => {
      const wordText = hom.hwi.hw || input;
      const pronunciation = hom.hwi.prs?.[0]?.mw || "";
      const fl = hom.fl || "";
      
      let sensesHtml = '';
      hom.def?.forEach(d => {
        d.sseq.forEach(seqGroup => {
          seqGroup.forEach(senseArr => {
            const sense = senseArr[1];
            if (!sense || !sense.dt) return;
            sense.dt.forEach(dtItem => {
              if (dtItem[0] === 'text') {
                sensesHtml += `<li>${mwTextToHTML(dtItem[1])}</li>`;
              } else if (dtItem[0] === 'vis') {
                dtItem[1].forEach(vis => {
                  sensesHtml += `<li style="color:gray; font-style:italic;">Example: ${mwTextToHTML(vis.t)}</li>`;
                });
              }
            });
          });
        });
      });

      html += `<div style="margin-bottom:16px;">
                 <h3>${wordText} ${pronunciation ? `(${pronunciation})` : ""}</h3>
                 <strong>${fl}</strong>
                 <ul style="margin-left:20px;">${sensesHtml}</ul>
               </div>`;
    });

    infoEl.innerHTML = html;
    resultsEl.innerHTML = "";

  } catch (err) {
    console.error(err);
    resultsEl.innerHTML = "<li>Error fetching dictionary data</li>";
  }
}
function mwTextToHTML(text) {
  if (!text) return "";

  return text
    .replace(/\{bc\}/g, "<br>")                        // break
    .replace(/\{it\}(.*?)\{\/it\}/g, "<em>$1</em>")    // italic
    .replace(/\{wi\}(.*?)\{\/wi\}/g, "<em>$1</em>")    // word italics
    .replace(/\{sx\|(.*?)\|.*?\}/g, "<strong>$1</strong>") // cross-ref / synonym
    .replace(/\{dxt\|(.*?)\|\|.*?\}/g, "<em>$1</em>")      // dx_def links
    .replace(/\{ldquo\}/g, "‚Äú")                        // left quote
    .replace(/\{rdquo\}/g, "‚Äù")                        // right quote
    .replace(/\{\/dx_def\}/g, "")                      // remove end tag
    .replace(/\{sc\}(.*?)\{\/sc\}/g, "<strong>$1</strong>"); // small caps to bold
}


// === Indicator Finder ===
async function solveIndicator(word) {
  const input = word || document.getElementById("indicator-input").value.trim();
  const resultsEl = document.getElementById("indicator-results");
  if (!input) return;
  resultsEl.innerHTML = "<li>Searching...</li>";

  try {
    const res = await fetch(`http://127.0.0.1:8000/indicator?word=${encodeURIComponent(input)}`);
    const data = await res.json();
    const list = data.results || [];

    resultsEl.innerHTML = list.length ? list.map(w => `<li>${w}</li>`).join("") : "<li>No results</li>";
    makeWordsClickable("indicator-results");
    addRecentSearch(input);
  } catch (err) {
    console.error(err);
    resultsEl.innerHTML = "<li>Error fetching indicator data</li>";
  }
}

// === Recent Searches ===
function addRecentSearch(word) {
  if (!word) return;

  let recent = JSON.parse(localStorage.getItem("recentSearches") || "[]");

  // Avoid duplicates
  if (!recent.includes(word.toLowerCase())) {
    recent.unshift(word.toLowerCase()); // add to beginning
    if (recent.length > 10) recent.pop(); // keep last 10
    localStorage.setItem("recentSearches", JSON.stringify(recent));
  }

  renderRecentSearches();
}

function renderRecentSearches() {
  const recentList = document.getElementById("recent-results");
  if (!recentList) return;

  recentList.innerHTML = "";

  const recent = JSON.parse(localStorage.getItem("recentSearches") || "[]");

  recent.forEach(word => {
    const li = document.createElement("li");
    li.innerHTML = `<span class="word-link">${word.charAt(0).toUpperCase() + word.slice(1)}</span>`;
    li.querySelector(".word-link").addEventListener("click", () => {
      reSearchAll(word);
    });
    recentList.appendChild(li);
  });
}

// Run when page loads
window.addEventListener("DOMContentLoaded", () => {
  renderRecentSearches();
});


// === Info window ===
const infoBtn = document.getElementById("info-btn");
const modal = document.getElementById("info-modal");
const closeModal = document.getElementById("close-modal");

// Open modal
infoBtn.addEventListener("click", () => {
  modal.classList.remove("hidden");
});

// Close modal
closeModal.addEventListener("click", () => {
  modal.classList.add("hidden");
});

// Close modal when clicking outside the content
modal.addEventListener("click", (e) => {
  if (e.target === modal) {
    modal.classList.add("hidden");
  }
});



// === Re-run all searches when clicking a recent term ===
function reSearchAll(word) {
  document.getElementById("dict-input").value = word;
  document.getElementById("anagram-input").value = word;
  document.getElementById("indicator-input").value = word;

  searchDictionary(word);
  solveAnagram(word);
  solveIndicator(word);
}

document.addEventListener("DOMContentLoaded", () => {
  const toggle = document.getElementById('dark-toggle');
  const saved = localStorage.getItem('darkMode');

  if (saved === "true") document.body.classList.add('dark-mode');
  if (saved === "false") document.body.classList.remove('dark-mode');

  toggle.addEventListener('click', () => {
    document.body.classList.toggle('dark-mode');
    localStorage.setItem('darkMode', document.body.classList.contains('dark-mode'));
  });
});


</script>
</body>
</html>
